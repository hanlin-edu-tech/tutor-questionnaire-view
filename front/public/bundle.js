var app=function(){"use strict";function e(){}function n(e){return e()}function t(){return Object.create(null)}function i(e){e.forEach(n)}function o(e){return"function"==typeof e}function s(e,n){return e!=e?n==n:e!==n||e&&"object"==typeof e||"function"==typeof e}function r(e,n){e.appendChild(n)}function u(e,n,t){e.insertBefore(n,t||null)}function c(e){e.parentNode.removeChild(e)}function d(e,n){for(let t=0;t<e.length;t+=1)e[t]&&e[t].d(n)}function l(e){return document.createElement(e)}function a(e){return document.createTextNode(e)}function f(){return a(" ")}function p(){return a("")}function m(e,n,t,i){return e.addEventListener(n,t,i),()=>e.removeEventListener(n,t,i)}function q(e,n,t){null==t?e.removeAttribute(n):e.setAttribute(n,t)}function h(e,n){n=""+n,e.data!==n&&(e.data=n)}function x(e,n){(null!=n||e.value)&&(e.value=n)}let g;function v(e){g=e}function $(e){(function(){if(!g)throw new Error("Function called outside component initialization");return g})().$$.on_mount.push(e)}const _=[],b=[],w=[],y=[],j=Promise.resolve();let k=!1;function E(e){w.push(e)}function O(){const e=new Set;do{for(;_.length;){const e=_.shift();v(e),A(e.$$)}for(;b.length;)b.pop()();for(let n=0;n<w.length;n+=1){const t=w[n];e.has(t)||(t(),e.add(t))}w.length=0}while(_.length);for(;y.length;)y.pop()();k=!1}function A(e){e.fragment&&(e.update(e.dirty),i(e.before_update),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_update.forEach(E))}const N=new Set;let C;function B(){C={r:0,c:[],p:C}}function S(){C.r||i(C.c),C=C.p}function I(e,n){e&&e.i&&(N.delete(e),e.i(n))}function L(e,n,t,i){if(e&&e.o){if(N.has(e))return;N.add(e),C.c.push(()=>{N.delete(e),i&&(t&&e.d(1),i())}),e.o(n)}}function M(e,t,s){const{fragment:r,on_mount:u,on_destroy:c,after_update:d}=e.$$;r.m(t,s),E(()=>{const t=u.map(n).filter(o);c?c.push(...t):i(t),e.$$.on_mount=[]}),d.forEach(E)}function T(e,n){e.$$.fragment&&(i(e.$$.on_destroy),e.$$.fragment.d(n),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={})}function D(e,n){e.$$.dirty||(_.push(e),k||(k=!0,j.then(O)),e.$$.dirty=t()),e.$$.dirty[n]=!0}function H(n,o,s,r,u,c){const d=g;v(n);const l=o.props||{},a=n.$$={fragment:null,ctx:null,props:c,update:e,not_equal:u,bound:t(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:[]),callbacks:t(),dirty:null};let f=!1;var p;a.ctx=s?s(n,l,(e,t,i=t)=>(a.ctx&&u(a.ctx[e],a.ctx[e]=i)&&(a.bound[e]&&a.bound[e](i),f&&D(n,e)),t)):l,a.update(),f=!0,i(a.before_update),a.fragment=r(a.ctx),o.target&&(o.hydrate?a.fragment.l((p=o.target,Array.from(p.childNodes))):a.fragment.c(),o.intro&&I(n.$$.fragment),M(n,o.target,o.anchor),O()),v(d)}class J{$destroy(){T(this,1),this.$destroy=e}$on(e,n){const t=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return t.push(n),()=>{const e=t.indexOf(n);-1!==e&&t.splice(e,1)}}$set(){}}function z(e,n,t){const i=Object.create(e);return i.o=n[t],i.j=t,i}function F(e,n,t){const i=Object.create(e);return i.o=n[t],i.j=t,i}function P(e){var n,t,i,o,s,d,p,g,v,$,_,b,w=e.index+1+"",y=e.question.topic+"",j=!0===e.question.required&&K();return{c(){n=l("div"),t=l("div"),i=a(w),o=a(". "),s=a(y),d=f(),j&&j.c(),p=f(),g=l("div"),v=l("textarea"),q(t,"class","form-topic"),q(v,"placeholder","請填入文字"),q(v,"name",$="qa"+e.index),q(v,"data-subject-answer","500"),q(g,"class","form-item"),q(n,"class","form-group"),q(n,"id",_="q"+e.index),b=m(v,"input",e.textarea_input_handler)},m(c,l){u(c,n,l),r(n,t),r(t,i),r(t,o),r(t,s),r(n,d),j&&j.m(n,null),r(n,p),r(n,g),r(g,v),x(v,e.questions[e.index].answer)},p(e,t){e.index&&w!==(w=t.index+1+"")&&h(i,w),e.question&&y!==(y=t.question.topic+"")&&h(s,y),!0===t.question.required?j||((j=K()).c(),j.m(n,p)):j&&(j.d(1),j=null),(e.questions||e.index)&&x(v,t.questions[t.index].answer),e.index&&$!==($="qa"+t.index)&&q(v,"name",$),e.index&&_!==(_="q"+t.index)&&q(n,"id",_)},d(e){e&&c(n),j&&j.d(),b()}}}function U(e){var n,t,i,o,s,p,m,x,g,v,$,_,b=e.index+1+"",w=e.question.topic+"",y=!0===e.question.required&&Q();let j=e.question.options,k=[];for(let n=0;n<j.length;n+=1)k[n]=R(z(e,j,n));return{c(){n=l("div"),t=l("div"),i=a(b),o=a(". "),s=a(w),p=f(),y&&y.c(),m=f(),(x=l("div")).innerHTML='<div class="multiple-text">複選</div>',g=f(),v=l("div");for(let e=0;e<k.length;e+=1)k[e].c();q(t,"class","form-topic"),q(x,"class","multiple"),q(v,"class","form-item"),q(v,"id",$="multi"+e.index),q(n,"class","form-group"),q(n,"id",_="q"+e.index)},m(e,c){u(e,n,c),r(n,t),r(t,i),r(t,o),r(t,s),r(n,p),y&&y.m(n,null),r(n,m),r(n,x),r(n,g),r(n,v);for(let e=0;e<k.length;e+=1)k[e].m(v,null)},p(e,t){if(e.index&&b!==(b=t.index+1+"")&&h(i,b),e.question&&w!==(w=t.question.topic+"")&&h(s,w),!0===t.question.required?y||((y=Q()).c(),y.m(n,m)):y&&(y.d(1),y=null),e.index||e.question||e.questions){let n;for(j=t.question.options,n=0;n<j.length;n+=1){const i=z(t,j,n);k[n]?k[n].p(e,i):(k[n]=R(i),k[n].c(),k[n].m(v,null))}for(;n<k.length;n+=1)k[n].d(1);k.length=j.length}e.index&&$!==($="multi"+t.index)&&q(v,"id",$),e.index&&_!==(_="q"+t.index)&&q(n,"id",_)},d(e){e&&c(n),y&&y.d(),d(k,e)}}}function G(e){var n,t,i,o,s,p,m,x,g,v=e.index+1+"",$=e.question.topic+"",_=!0===e.question.required&&V();let b=e.question.options,w=[];for(let n=0;n<b.length;n+=1)w[n]=W(F(e,b,n));return{c(){n=l("div"),t=l("div"),i=a(v),o=a(". "),s=a($),p=f(),_&&_.c(),m=f(),x=l("div");for(let e=0;e<w.length;e+=1)w[e].c();q(t,"class","form-topic"),q(x,"class","form-item"),q(n,"class","form-group"),q(n,"id",g="q"+e.index)},m(e,c){u(e,n,c),r(n,t),r(t,i),r(t,o),r(t,s),r(n,p),_&&_.m(n,null),r(n,m),r(n,x);for(let e=0;e<w.length;e+=1)w[e].m(x,null)},p(e,t){if(e.index&&v!==(v=t.index+1+"")&&h(i,v),e.question&&$!==($=t.question.topic+"")&&h(s,$),!0===t.question.required?_||((_=V()).c(),_.m(n,m)):_&&(_.d(1),_=null),e.index||e.question||e.questions){let n;for(b=t.question.options,n=0;n<b.length;n+=1){const i=F(t,b,n);w[n]?w[n].p(e,i):(w[n]=W(i),w[n].c(),w[n].m(x,null))}for(;n<w.length;n+=1)w[n].d(1);w.length=b.length}e.index&&g!==(g="q"+t.index)&&q(n,"id",g)},d(e){e&&c(n),_&&_.d(),d(w,e)}}}function K(e){var n;return{c(){(n=l("div")).textContent="*請填寫這個欄位*",q(n,"class","form-must")},m(e,t){u(e,n,t)},d(e){e&&c(n)}}}function Q(e){var n;return{c(){(n=l("div")).textContent="*請填寫這個欄位*",q(n,"class","form-must")},m(e,t){u(e,n,t)},d(e){e&&c(n)}}}function R(e){var n,t,i,o,s,d,p,x,g,v,$,_=e.o+"";return{c(){n=l("div"),t=l("input"),d=f(),p=l("label"),x=a(_),v=f(),e.$$binding_groups[0].push(t),q(t,"id",i="q"+e.index+"o"+e.j),q(t,"type","checkbox"),q(t,"name",o="multi"+e.index),t.__value=s=e.o,t.value=t.__value,q(p,"for",g="q"+e.index+"o"+e.j),q(n,"class","control"),$=m(t,"change",e.input_change_handler_1)},m(i,o){u(i,n,o),r(n,t),t.checked=~e.questions[e.index].answer.indexOf(t.__value),r(n,d),r(n,p),r(p,x),r(n,v)},p(e,n){(e.questions||e.index)&&(t.checked=~n.questions[n.index].answer.indexOf(t.__value)),e.index&&i!==(i="q"+n.index+"o"+n.j)&&q(t,"id",i),e.index&&o!==(o="multi"+n.index)&&q(t,"name",o),e.question&&s!==(s=n.o)&&(t.__value=s),t.value=t.__value,e.question&&_!==(_=n.o+"")&&h(x,_),e.index&&g!==(g="q"+n.index+"o"+n.j)&&q(p,"for",g)},d(i){i&&c(n),e.$$binding_groups[0].splice(e.$$binding_groups[0].indexOf(t),1),$()}}}function V(e){var n;return{c(){(n=l("div")).textContent="*請填寫這個欄位*",q(n,"class","form-must")},m(e,t){u(e,n,t)},d(e){e&&c(n)}}}function W(e){var n,t,i,o,s,d,p,x,g,v,$,_=e.o+"";return{c(){n=l("div"),t=l("input"),d=f(),p=l("label"),x=a(_),v=f(),e.$$binding_groups[0].push(t),q(t,"id",i="q"+e.index+"o"+e.j),q(t,"type","radio"),q(t,"name",o="single"+e.index),t.__value=s=e.o,t.value=t.__value,q(p,"for",g="q"+e.index+"o"+e.j),q(n,"class","control"),$=m(t,"change",e.input_change_handler)},m(i,o){u(i,n,o),r(n,t),t.checked=t.__value===e.questions[e.index].answer,r(n,d),r(n,p),r(p,x),r(n,v)},p(e,n){(e.questions||e.index)&&(t.checked=t.__value===n.questions[n.index].answer),e.index&&i!==(i="q"+n.index+"o"+n.j)&&q(t,"id",i),e.index&&o!==(o="single"+n.index)&&q(t,"name",o),e.question&&s!==(s=n.o)&&(t.__value=s),t.value=t.__value,e.question&&_!==(_=n.o+"")&&h(x,_),e.index&&g!==(g="q"+n.index+"o"+n.j)&&q(p,"for",g)},d(i){i&&c(n),e.$$binding_groups[0].splice(e.$$binding_groups[0].indexOf(t),1),$()}}}function X(n){var t;function i(e,n){return"單選題"===n.question.type?G:"多選題"===n.question.type?U:P}var o=i(0,n),s=o(n);return{c(){s.c(),t=p()},m(e,n){s.m(e,n),u(e,t,n)},p(e,n){o===(o=i(0,n))&&s?s.p(e,n):(s.d(1),(s=o(n))&&(s.c(),s.m(t.parentNode,t)))},i:e,o:e,d(e){s.d(e),e&&c(t)}}}function Y(e,n,t){let{questions:i,question:o,index:s}=n;const r=[[]];return e.$set=(e=>{"questions"in e&&t("questions",i=e.questions),"question"in e&&t("question",o=e.question),"index"in e&&t("index",s=e.index)}),{questions:i,question:o,index:s,input_change_handler:function(){i[s].answer=this.__value,t("questions",i),t("index",s)},input_change_handler_1:function(){i[s].answer=function(e){const n=[];for(let t=0;t<e.length;t+=1)e[t].checked&&n.push(e[t].__value);return n}(r[0]),t("questions",i),t("index",s)},textarea_input_handler:function(){i[s].answer=this.value,t("questions",i),t("index",s)},$$binding_groups:r}}class Z extends J{constructor(e){super(),H(this,e,Y,X,s,["questions","question","index"])}}function ee(e,n,t){const i=Object.create(e);return i.q=n[t],i.i=t,i}function ne(n){var t;return{c(){t=a("loading")},m(e,n){u(e,t,n)},p:e,i:e,o:e,d(e){e&&c(t)}}}function te(e){var n,t,i,o,s,x,g,v,$,_,b,w,y,j,k,E,O,A=e.template.name+"",N=e.template.description+"";let C=e.template.questions,M=[];for(let n=0;n<C.length;n+=1)M[n]=ie(ee(e,C,n));const T=e=>L(M[e],1,1,()=>{M[e]=null});var D=!0===e.success&&oe();return{c(){n=l("div"),t=l("div"),i=l("div"),o=a(A),s=f(),x=l("div"),g=a(N),v=f(),$=l("form"),_=l("div");for(let e=0;e<M.length;e+=1)M[e].c();b=f(),w=l("div"),(y=l("div")).textContent="送出",j=f(),D&&D.c(),k=p(),q(i,"class","form-title"),q(x,"class","form-content"),q(t,"class","alert"),q(_,"class","form-body"),q(y,"class","btn-send"),q(w,"class","row-btn"),q($,"action",""),q($,"id","form"),q(n,"class","container"),O=m(y,"click",e.submit)},m(e,c){u(e,n,c),r(n,t),r(t,i),r(i,o),r(t,s),r(t,x),r(x,g),r(n,v),r(n,$),r($,_);for(let e=0;e<M.length;e+=1)M[e].m(_,null);r($,b),r($,w),r(w,y),u(e,j,c),D&&D.m(e,c),u(e,k,c),E=!0},p(e,n){if(E&&!e.template||A===(A=n.template.name+"")||h(o,A),E&&!e.template||N===(N=n.template.description+"")||h(g,N),e.template||e.questions){let t;for(C=n.template.questions,t=0;t<C.length;t+=1){const i=ee(n,C,t);M[t]?(M[t].p(e,i),I(M[t],1)):(M[t]=ie(i),M[t].c(),I(M[t],1),M[t].m(_,null))}for(B(),t=C.length;t<M.length;t+=1)T(t);S()}!0===n.success?D||((D=oe()).c(),D.m(k.parentNode,k)):D&&(D.d(1),D=null)},i(e){if(!E){for(let e=0;e<C.length;e+=1)I(M[e]);E=!0}},o(e){M=M.filter(Boolean);for(let e=0;e<M.length;e+=1)L(M[e]);E=!1},d(e){e&&c(n),d(M,e),e&&c(j),D&&D.d(e),e&&c(k),O()}}}function ie(e){var n,t=new Z({props:{question:e.q,index:e.i,questions:e.questions}});return{c(){t.$$.fragment.c()},m(e,i){M(t,e,i),n=!0},p(e,n){var i={};e.template&&(i.question=n.q),t.$set(i)},i(e){n||(I(t.$$.fragment,e),n=!0)},o(e){L(t.$$.fragment,e),n=!1},d(e){T(t,e)}}}function oe(e){var n;return{c(){(n=l("div")).innerHTML='<div class="modal-body"><div class="success-banner"></div> <div class="success-text">送出成功</div> <div class="success-content">我們已收到您的回饋</div></div>',q(n,"class","modal-success")},m(e,t){u(e,n,t)},d(e){e&&c(n)}}}function se(e){var n,t,i,o,s,r,d=[te,ne],a=[];function m(e,n){return n.template?0:1}return i=m(0,e),o=a[i]=d[i](e),{c(){n=l("div"),t=f(),o.c(),s=p(),q(n,"class","g-signin2"),q(n,"data-onsuccess","onSignIn"),q(n,"data-theme","dark")},m(e,o){u(e,n,o),u(e,t,o),a[i].m(e,o),u(e,s,o),r=!0},p(e,n){var t=i;(i=m(0,n))===t?a[i].p(e,n):(B(),L(a[t],1,1,()=>{a[t]=null}),S(),(o=a[i])||(o=a[i]=d[i](n)).c(),I(o,1),o.m(s.parentNode,s))},i(e){r||(I(o),r=!0)},o(e){L(o),r=!1},d(e){e&&(c(n),c(t)),a[i].d(e),e&&c(s)}}}function re(e,n,t){let i,o,s,r={started:null,finished:null,questions:[],template:""},u=new Array;const c=window.location.search.substring(4,window.location.search.length);return $(async()=>{await fetch(`https://www.tbbt.com.tw/questionnaire/templates/${c}`).then(e=>e.json()).then(e=>{r.started=new Date,r.template=c,s=e.callBackUrl,t("template",i=e);const n=e.questions.length;for(let t=0;t<n;t++)u.push({topic:e.questions[t].topic,answer:"",required:e.questions[t].required,type:e.questions[t].type,options:e.questions[t].options})})}),{template:i,questions:u,success:o,submit:function(){if(console.log("submit"),!function(){let e=!0;return u.forEach((n,t)=>{!0===n.required&&("問答題"===n.type&&""===n.answer.trim()?(document.getElementById("q"+t).setAttribute("style","border: 1px solid red"),e=!1):""===n.answer&&(document.getElementById("q"+t).setAttribute("style","border: 1px solid red"),e=!1))}),e}())return t("success",o=!1),!1;r.finished=new Date,r.questions=u,u.forEach(e=>{Array.isArray(e.answer)||(e.answer=[e.answer])}),console.log("questionnaire: ",r),fetch(`https://www.tbbt.com.tw/questionnaire/questionnaire/create?templateId=${c}`,{method:"post",body:JSON.stringify(r),headers:{"content-type":"application/json"},credentials:"include"}).then(function(e){return e.ok&&t("success",o=!0),e.text()}).then(e=>{console.log(JSON.stringify(e)),""!==s&&(window.location.href=s)})}}}return new class extends J{constructor(e){super(),H(this,e,re,se,s,[])}}({target:document.body,props:{name:"world"}})}();
//# sourceMappingURL=bundle.js.map
