var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function a(t){return"function"==typeof t}function o(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function i(t,e){t.appendChild(e)}function c(t,e,n){t.insertBefore(e,n||null)}function l(t){t.parentNode.removeChild(t)}function u(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function s(t){return document.createElement(t)}function d(t){return document.createTextNode(t)}function p(){return d(" ")}function f(){return d("")}function m(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function h(t,e,n){null==n?t.removeAttribute(e):t.setAttribute(e,n)}function v(t,e){e=""+e,t.data!==e&&(t.data=e)}function _(t,e){(null!=e||t.value)&&(t.value=e)}let g;function $(t){g=t}function q(t){(function(){if(!g)throw new Error("Function called outside component initialization");return g})().$$.on_mount.push(t)}const w=[],b=[],y=[],x=[],A=Promise.resolve();let j=!1;function k(t){y.push(t)}function O(){const t=new Set;do{for(;w.length;){const t=w.shift();$(t),E(t.$$)}for(;b.length;)b.pop()();for(let e=0;e<y.length;e+=1){const n=y[e];t.has(n)||(n(),t.add(n))}y.length=0}while(w.length);for(;x.length;)x.pop()();j=!1}function E(t){t.fragment&&(t.update(t.dirty),r(t.before_update),t.fragment.p(t.dirty,t.ctx),t.dirty=null,t.after_update.forEach(k))}const C=new Set;function N(t,e){t.$$.dirty||(w.push(t),j||(j=!0,A.then(O)),t.$$.dirty=n()),t.$$.dirty[e]=!0}function L(o,i,c,l,u,s){const d=g;$(o);const p=i.props||{},f=o.$$={fragment:null,ctx:null,props:s,update:t,not_equal:u,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:[]),callbacks:n(),dirty:null};let m=!1;var h,v,_;f.ctx=c?c(o,p,(t,e,n=e)=>(f.ctx&&u(f.ctx[t],f.ctx[t]=n)&&(f.bound[t]&&f.bound[t](n),m&&N(o,t)),e)):p,f.update(),m=!0,r(f.before_update),f.fragment=l(f.ctx),i.target&&(i.hydrate?f.fragment.l((_=i.target,Array.from(_.childNodes))):f.fragment.c(),i.intro&&((h=o.$$.fragment)&&h.i&&(C.delete(h),h.i(v))),function(t,n,o){const{fragment:i,on_mount:c,on_destroy:l,after_update:u}=t.$$;i.m(n,o),k(()=>{const n=c.map(e).filter(a);l?l.push(...n):r(n),t.$$.on_mount=[]}),u.forEach(k)}(o,i.target,i.anchor),O()),$(d)}class M{$destroy(){var e,n;n=1,(e=this).$$.fragment&&(r(e.$$.on_destroy),e.$$.fragment.d(n),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={}),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}function S(t,e,n){const r=Object.create(t);return r.o=e[n],r.j=n,r}function T(t,e,n){const r=Object.create(t);return r.o=e[n],r.j=n,r}function H(t,e,n){const r=Object.create(t);return r.q=e[n],r.i=n,r}function P(e){var n;return{c(){n=d("loading")},m(t,e){c(t,n,e)},p:t,d(t){t&&l(n)}}}function z(t){var e,n,r,a,o,f,_,g,$,q,w,b,y,x,A,j,k=t.template.name+"",O=t.template.description+"";let E=t.template.questions,C=[];for(let e=0;e<E.length;e+=1)C[e]=X(H(t,E,e));return{c(){e=s("div"),n=s("div"),r=s("div"),a=d(k),o=p(),f=s("div"),_=d(O),g=p(),$=s("form"),q=s("div");for(let t=0;t<C.length;t+=1)C[t].c();var i,c,l;w=p(),b=s("div"),(y=s("button")).textContent="送出",x=p(),(A=s("div")).innerHTML='<div class="modal-body"><div class="success-banner"></div> <div class="success-text">送出成功</div> <div class="success-content">我們已收到您的回饋</div></div>',h(r,"class","form-title"),h(f,"class","form-content"),h(n,"class","alert"),h(q,"class","form-body"),h(y,"class","btn-send"),h(b,"class","row-btn"),h($,"action",""),h($,"id","form"),h(e,"class","container"),h(A,"class","modal-success"),i="display",c="none",A.style.setProperty(i,c,l?"important":""),j=m(y,"click",t.submit)},m(t,l){c(t,e,l),i(e,n),i(n,r),i(r,a),i(n,o),i(n,f),i(f,_),i(e,g),i(e,$),i($,q);for(let t=0;t<C.length;t+=1)C[t].m(q,null);i($,w),i($,b),i(b,y),c(t,x,l),c(t,A,l)},p(t,e){if(t.template&&k!==(k=e.template.name+"")&&v(a,k),t.template&&O!==(O=e.template.description+"")&&v(_,O),t.template||t.dataArr){let n;for(E=e.template.questions,n=0;n<E.length;n+=1){const r=H(e,E,n);C[n]?C[n].p(t,r):(C[n]=X(r),C[n].c(),C[n].m(q,null))}for(;n<C.length;n+=1)C[n].d(1);C.length=E.length}},d(t){t&&l(e),u(C,t),t&&(l(x),l(A)),j()}}}function B(t){var e,n,r,a,o,u,f,m,_,g=t.i+1+"",$=t.q.topic+"",q=!0===t.q.required&&J();function w(t,e){return!0===e.q.required?G:D}var b=w(0,t),y=b(t);return{c(){e=s("div"),n=s("div"),r=d(g),a=d(". "),o=d($),u=p(),q&&q.c(),f=p(),m=s("div"),y.c(),_=p(),h(n,"class","form-topic"),h(m,"class","form-item"),h(e,"class","form-group")},m(t,l){c(t,e,l),i(e,n),i(n,r),i(n,a),i(n,o),i(e,u),q&&q.m(e,null),i(e,f),i(e,m),y.m(m,null),i(e,_)},p(t,n){t.template&&$!==($=n.q.topic+"")&&v(o,$),!0===n.q.required?q||((q=J()).c(),q.m(e,f)):q&&(q.d(1),q=null),b===(b=w(0,n))&&y?y.p(t,n):(y.d(1),(y=b(n))&&(y.c(),y.m(m,null)))},d(t){t&&l(e),q&&q.d(),y.d()}}}function F(t){var e,n,r,a,o,f,m,_,g,$,q,w=t.i+1+"",b=t.q.topic+"",y=!0===t.q.required&&K();let x=t.q.options,A=[];for(let e=0;e<x.length;e+=1)A[e]=Q(S(t,x,e));return{c(){e=s("div"),n=s("div"),r=d(w),a=d(". "),o=d(b),f=p(),y&&y.c(),m=p(),(_=s("div")).innerHTML='<div class="multiple-text">複選</div>',g=p(),$=s("div");for(let t=0;t<A.length;t+=1)A[t].c();q=p(),h(n,"class","form-topic"),h(_,"class","multiple"),h($,"class","form-item"),h($,"id","multi"+t.i),h(e,"class","form-group")},m(t,l){c(t,e,l),i(e,n),i(n,r),i(n,a),i(n,o),i(e,f),y&&y.m(e,null),i(e,m),i(e,_),i(e,g),i(e,$);for(let t=0;t<A.length;t+=1)A[t].m($,null);i(e,q)},p(t,n){if(t.template&&b!==(b=n.q.topic+"")&&v(o,b),!0===n.q.required?y||((y=K()).c(),y.m(e,m)):y&&(y.d(1),y=null),t.template||t.dataArr){let e;for(x=n.q.options,e=0;e<x.length;e+=1){const r=S(n,x,e);A[e]?A[e].p(t,r):(A[e]=Q(r),A[e].c(),A[e].m($,null))}for(;e<A.length;e+=1)A[e].d(1);A.length=x.length}},d(t){t&&l(e),y&&y.d(),u(A,t)}}}function I(t){var e,n,r,a,o,f,m,_,g,$=t.i+1+"",q=t.q.topic+"",w=!0===t.q.required&&R();let b=t.q.options,y=[];for(let e=0;e<b.length;e+=1)y[e]=W(T(t,b,e));return{c(){e=s("div"),n=s("div"),r=d($),a=d(". "),o=d(q),f=p(),w&&w.c(),m=p(),_=s("div");for(let t=0;t<y.length;t+=1)y[t].c();g=p(),h(n,"class","form-topic"),h(_,"class","form-item"),h(e,"class","form-group")},m(t,l){c(t,e,l),i(e,n),i(n,r),i(n,a),i(n,o),i(e,f),w&&w.m(e,null),i(e,m),i(e,_);for(let t=0;t<y.length;t+=1)y[t].m(_,null);i(e,g)},p(t,n){if(t.template&&q!==(q=n.q.topic+"")&&v(o,q),!0===n.q.required?w||((w=R()).c(),w.m(e,m)):w&&(w.d(1),w=null),t.template||t.dataArr){let e;for(b=n.q.options,e=0;e<b.length;e+=1){const r=T(n,b,e);y[e]?y[e].p(t,r):(y[e]=W(r),y[e].c(),y[e].m(_,null))}for(;e<y.length;e+=1)y[e].d(1);y.length=b.length}},d(t){t&&l(e),w&&w.d(),u(y,t)}}}function J(t){var e;return{c(){(e=s("div")).textContent="*請填寫這個欄位*",h(e,"class","form-must")},m(t,n){c(t,e,n)},d(t){t&&l(e)}}}function D(t){var e,n;function a(){t.textarea_input_handler_1.call(e,t)}return{c(){h(e=s("textarea"),"placeholder","請填入文字"),h(e,"name","qa"+t.i),h(e,"data-subject-answer","500"),n=[m(e,"input",a),m(e,"click",t.test)]},m(n,r){c(n,e,r),_(e,t.dataArr[t.i].answer)},p(n,r){t=r,n.dataArr&&_(e,t.dataArr[t.i].answer)},d(t){t&&l(e),r(n)}}}function G(t){var e,n;function a(){t.textarea_input_handler.call(e,t)}return{c(){h(e=s("textarea"),"placeholder","請填入文字"),h(e,"name","qa"+t.i),h(e,"data-subject-answer","500"),e.required=!0,n=[m(e,"input",a),m(e,"click",t.test)]},m(n,r){c(n,e,r),_(e,t.dataArr[t.i].answer)},p(n,r){t=r,n.dataArr&&_(e,t.dataArr[t.i].answer)},d(t){t&&l(e),r(n)}}}function K(t){var e;return{c(){(e=s("div")).textContent="*請填寫這個欄位*",h(e,"class","form-must")},m(t,n){c(t,e,n)},d(t){t&&l(e)}}}function Q(t){var e,n,a,o,u,f,_,g,$=t.o+"";function q(){t.input_change_handler_2.call(n,t)}return{c(){e=s("div"),n=s("input"),o=p(),u=s("label"),f=d($),_=p(),t.$$binding_groups[0].push(n),h(n,"id","q"+t.i+"o"+t.j),h(n,"type","checkbox"),h(n,"name","multi"+t.i),n.__value=a=t.o,n.value=n.__value,h(u,"for","q"+t.i+"o"+t.j),h(e,"class","control"),g=[m(n,"change",q),m(n,"click",t.test)]},m(r,a){c(r,e,a),i(e,n),n.checked=~t.dataArr[t.i].answer.indexOf(n.__value),i(e,o),i(e,u),i(u,f),i(e,_)},p(e,r){t=r,e.dataArr&&(n.checked=~t.dataArr[t.i].answer.indexOf(n.__value)),e.template&&a!==(a=t.o)&&(n.__value=a),n.value=n.__value,e.template&&$!==($=t.o+"")&&v(f,$)},d(a){a&&l(e),t.$$binding_groups[0].splice(t.$$binding_groups[0].indexOf(n),1),r(g)}}}function R(t){var e;return{c(){(e=s("div")).textContent="*請填寫這個欄位*",h(e,"class","form-must")},m(t,n){c(t,e,n)},d(t){t&&l(e)}}}function U(t){var e,n,a;function o(){t.input_change_handler_1.call(e,t)}return{c(){e=s("input"),t.$$binding_groups[0].push(e),h(e,"id","q"+t.i+"o"+t.j),h(e,"type","radio"),h(e,"name","single"+t.i),e.__value=n=t.o,e.value=e.__value,a=[m(e,"change",o),m(e,"click",t.test)]},m(n,r){c(n,e,r),e.checked=e.__value===t.dataArr[t.i].answer},p(r,a){t=a,r.dataArr&&(e.checked=e.__value===t.dataArr[t.i].answer),r.template&&n!==(n=t.o)&&(e.__value=n),e.value=e.__value},d(n){n&&l(e),t.$$binding_groups[0].splice(t.$$binding_groups[0].indexOf(e),1),r(a)}}}function V(t){var e,n,a;function o(){t.input_change_handler.call(e,t)}return{c(){e=s("input"),t.$$binding_groups[0].push(e),h(e,"id","q"+t.i+"o"+t.j),h(e,"type","radio"),h(e,"name","single"+t.i),e.__value=n=t.o,e.value=e.__value,e.required=!0,a=[m(e,"change",o),m(e,"click",t.test)]},m(n,r){c(n,e,r),e.checked=e.__value===t.dataArr[t.i].answer},p(r,a){t=a,r.dataArr&&(e.checked=e.__value===t.dataArr[t.i].answer),r.template&&n!==(n=t.o)&&(e.__value=n),e.value=e.__value},d(n){n&&l(e),t.$$binding_groups[0].splice(t.$$binding_groups[0].indexOf(e),1),r(a)}}}function W(t){var e,n,r,a,o,u=t.o+"";function f(t,e){return!0===e.q.required&&0===e.j?V:U}var m=f(0,t),_=m(t);return{c(){e=s("div"),_.c(),n=p(),r=s("label"),a=d(u),o=p(),h(r,"for","q"+t.i+"o"+t.j),h(e,"class","control")},m(t,l){c(t,e,l),_.m(e,null),i(e,n),i(e,r),i(r,a),i(e,o)},p(t,r){m===(m=f(0,r))&&_?_.p(t,r):(_.d(1),(_=m(r))&&(_.c(),_.m(e,n))),t.template&&u!==(u=r.o+"")&&v(a,u)},d(t){t&&l(e),_.d()}}}function X(t){var e;function n(t,e){return"單選題"===e.q.type?I:"多選題"===e.q.type?F:B}var r=n(0,t),a=r(t);return{c(){a.c(),e=f()},m(t,n){a.m(t,n),c(t,e,n)},p(t,o){r===(r=n(0,o))&&a?a.p(t,o):(a.d(1),(a=r(o))&&(a.c(),a.m(e.parentNode,e)))},d(t){a.d(t),t&&l(e)}}}function Y(e){var n;function r(t,e){return e.template?z:P}var a=r(0,e),o=a(e);return{c(){o.c(),n=f()},m(t,e){o.m(t,e),c(t,n,e)},p(t,e){a===(a=r(0,e))&&o?o.p(t,e):(o.d(1),(o=a(e))&&(o.c(),o.m(n.parentNode,n)))},i:t,o:t,d(t){o.d(t),t&&l(n)}}}function Z(t,e,n){let r,a=new Array;const o=window.location.search.substring(4,window.location.search.length);q(async()=>{await fetch(`https://www.tbbt.com.tw/questionnaire/templates/${o}`).then(t=>t.json()).then(t=>{n("template",r=t);const e=t.questions.length;for(let n=0;n<e;n++)a.push({topic:t.questions[n].topic,answer:"",required:t.questions[n].required,type:t.questions[n].type,options:t.questions[n].options})})});const i=[[]];return{template:r,dataArr:a,submit:function(){if(!function(){let t=!0;return a.forEach(e=>{if(!0===e.required){if("問答題"===e.type&&""===e.answer.trim())return console.log("invalid"),t=!1;if(""===e.answer)return t=!1}}),t}())return!1;console.log("unconverted answer: ",a),a.forEach(t=>{Array.isArray(t.answer)||(t.answer=[t.answer])}),console.log("convert answer: ",a),fetch(`https://www.tbbt.com.tw/questionnaire/questionnaire/create?templateId=${o}`,{method:"post",body:JSON.stringify(a),headers:{"content-type":"application/json"}}).then(t=>{console.log(t.json())})},test:function(){console.log(a)},input_change_handler:function({i:t}){a[t].answer=this.__value,n("dataArr",a)},input_change_handler_1:function({i:t}){a[t].answer=this.__value,n("dataArr",a)},input_change_handler_2:function({i:t}){a[t].answer=function(t){const e=[];for(let n=0;n<t.length;n+=1)t[n].checked&&e.push(t[n].__value);return e}(i[0]),n("dataArr",a)},textarea_input_handler:function({i:t}){a[t].answer=this.value,n("dataArr",a)},textarea_input_handler_1:function({i:t}){a[t].answer=this.value,n("dataArr",a)},$$binding_groups:i}}return new class extends M{constructor(t){super(),L(this,t,Z,Y,o,[])}}({target:document.body,props:{name:"world"}})}();
//# sourceMappingURL=bundle.js.map
